---
title: "christmas-markets"
author: "daum-pollex-sung"
date: "2024-10-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(sf)
library(tmap)
library(tmaptools)
library(here)

here()

fname <- st_read("data/bezirksgrenzen.shp") |>
  select(Gemeinde_n)

qtm(fname)
fname

christmas_markets <- read.csv2("data/christmas_markets.csv") %>%
  select(name, bezirk, strasse) %>%
  left_join(pop, by="bezirk")

christmas_markets

coords <- geocode_OSM(christmas_markets$strasse)

pop <- read.csv("data/Einwohner.csv") %>%
  mutate_at(c("Population"), as.numeric)
head(pop)

coords
# Count of Christmas Markets per Bezirk




problems(christmas_markets)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

districts_file <- "/Users/yunteee/Documents/GitHub/07-geospatial-analysis-sf-daum-pollex-sung/data/bezirksgrenzen.geojson"  # Berlin districts GeoJSON path

berlin_districts <- st_read(districts_file) %>%
  mutate(Gemeinde_name = clean_district_names(Gemeinde_name))

ggplot()+
  geom_sf(data=berlin_districts) +
  theme_minimal()

berlin_districts %>%
  select(Gemeinde_name, geometry)


```


```{r}
christmas_markets_url <- "https://www.berlin.de/sen/web/service/maerkte-feste/weihnachtsmaerkte/index.php/index/all.geojson?q="

christmas_markets <- st_read(christmas_markets_url)
christmas_markets %>%
  select(title, geometry)

ggplot() +
  geom_sf(data=christmas_markets) +
  theme_minimal()

```


```{r}
st_crs(christmas_markets) <- st_crs(berlin_districts)
christmas_markets_berlin <- st_intersection(christmas_markets, berlin_districts)

christmas_markets_berlin

ggplot() +
  geom_sf(data = berlin_districts) + 
  geom_sf(data = christmas_markets_berlin) +
  theme_minimal()

```


```{r}
ggplot(data = berlin_districts) +
  geom_sf(fill = 'darkolivegreen', color = "white", size = 0.4, alpha = 0.8) +  # District borders in white
  # Plot each Christmas market as a red point
  geom_sf(data = christmas_markets_berlin, aes(geometry = geometry), color = "#D94854", size = 2, shape = 21, fill = "#D94854") +
  # Plot the Hertie School Point in yellow
  geom_sf(data = hertie_point, 
          aes(geometry = geometry), 
          color = "#F2D94A", 
          size = 3, 
          shape = 23, 
          fill = "#F2D94A") +
  geom_text(data = hertie_point, 
            aes(x = st_coordinates(geometry)[1], 
                y = st_coordinates(geometry)[2] + 0.001, 
                label = name), 
            size = 3,  
            color = "white", 
            fontface = "bold") +
  # Add district names at centroids
  geom_text(data = berlin_districts_centroids, 
            aes(x = st_coordinates(geometry)[, 1], 
                y = st_coordinates(geometry)[, 2], 
                label = split_name), 
            size = 3,  
            color = "white", 
            fontface = "bold",
            lineheight = 0.8) + 
  labs(title = "Berlin Christmas Markets",
       caption = "Data Source: Open Data Berlin & Wikipedia") +
  theme_minimal() +
  theme(axis.title = element_blank(), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(), 
        panel.grid = element_blank()) 
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
